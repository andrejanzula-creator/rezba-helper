<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>–¢–æ–∫–∞—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    h1 { text-align: center; color: #2e7d32; margin: 25px 0; font-size: 26px; }
    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      -webkit-appearance: none;
    }
    .btn:hover { background: #388E3C; }
    input, select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      -webkit-appearance: none;
    }
    .result { 
      background: white; 
      padding: 15px; 
      margin: 15px 0; 
      border-radius: 8px; 
      border-left: 4px solid #4CAF50;
    }
    .back { background: #999 !important; }
    .pass-item {
      background: white;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .pass-main {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .pass-increment {
      color: #555;
      font-size: 14px;
    }
    .pass-check {
      width: 40px;
      height: 40px;
      font-size: 20px;
      background: #f1f1f1;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-appearance: none;
      float: right;
    }
    .pass-check.done {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .progress-bar {
      text-align: center;
      font-weight: bold;
      color: #2e7d32;
      margin: 10px 0;
      font-size: 18px;
    }
    .group-title {
      background: #e8f5e9;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      font-weight: bold;
      text-align: center;
    }
    .info-note {
      font-style: italic;
      color: #555;
      margin-top: 8px;
      font-size: 14px;
    }
    .standard-step {
      font-weight: bold;
      color: #2e7d32;
    }
    
    /* –í—Å–µ —à–∞–≥–∏ —Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    [id^="step"] { display: none; }
  </style>
</head>
<body>

<h1>üîß –¢–æ–∫–∞—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h1>

<!-- –®–∞–≥ 0: –í—ã–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
<div id="stepOperation">
  <p><strong>–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é:</strong></p>
  <button class="btn" onclick="setOperation('threading')">–ù–∞—Ä–µ–∑–∫–∞ —Ä–µ–∑—å–±—ã</button>
  <button class="btn" onclick="setOperation('cutting')">–û—Ç—Ä–µ–∑–∞–Ω–∏–µ</button>
  <button class="btn" onclick="setOperation('turning')">–¢–æ—á–µ–Ω–∏–µ</button>
  <button class="btn" onclick="setOperation('drilling')">–°–≤–µ—Ä–ª–µ–Ω–∏–µ</button>
  <button class="btn" onclick="setOperation('chamfer')">–§–∞—Å–∫–∏</button>
  
  <div style="margin-top: 30px; font-size: 16px; color: #2e7d32; text-align: center; font-weight: bold;">
    –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞: <a href="https://www.youtube.com/@–ü–æ—Å–ª—É—à–Ω—ã–π–ú–µ—Ç–∞–ª–ª" target="_blank" style="color: #2e7d32; text-decoration: none;">üì∫ –ü–æ—Å–ª—É—à–Ω—ã–π –ú–µ—Ç–∞–ª–ª</a>
  </div>
</div>

<!-- === –ù–ê–†–ï–ó–ö–ê –†–ï–ó–¨–ë–´ === -->
<div id="stepThreadType">
  <p><strong>–¢–∏–ø —Ä–µ–∑—å–±—ã:</strong></p>
  <button class="btn" onclick="setThreadType('external')">–ù–∞—Ä—É–∂–Ω–∞—è</button>
  <button class="btn" onclick="setThreadType('internal')">–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è</button>
  <button class="btn back" onclick="backToOperation()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepGroup">
  <p><strong>–ì—Ä—É–ø–ø–∞ —Ä–µ–∑—å–±:</strong></p>
  <button class="btn" onclick="selectGroup('small')">–ú3 ‚Äì –ú20</button>
  <button class="btn" onclick="selectGroup('medium')">–ú22 ‚Äì –ú40</button>
  <button class="btn" onclick="selectGroup('large')">–ú42 ‚Äì –ú60</button>
  <button class="btn" onclick="selectGroup('extra')">–ú62 ‚Äì –ú100</button>
  <button class="btn back" onclick="backToThreadType()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="step1">
  <p><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—å–±—É:</strong></p>
  <div id="diaList"></div>
  <button class="btn back" onclick="backToGroup()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepPitch">
  <p><strong>–®–∞–≥ –¥–ª—è <span id="pitchFor">–ú20</span>:</strong></p>
  <select id="pitchSelect" size="5"></select>
  <button class="btn" onclick="selectPitch()">–î–∞–ª–µ–µ</button>
  <button class="btn back" onclick="backToDiameter()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepDiv">
  <p><strong>–¶–µ–Ω–∞ –¥–µ–ª–µ–Ω–∏—è –ª–∏–º–±–∞ (–º–º):</strong></p>
  <button class="btn" onclick="setDivision(0.05)">0.05 –º–º</button>
  <button class="btn" onclick="setDivision(0.02)">0.02 –º–º</button>
  <button class="btn" onclick="setDivision(0.025)">0.025 –º–º</button>
  <button class="btn" onclick="setDivision(0.01)">0.01 –º–º</button>
  <button class="btn back" onclick="backToPitch()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepMaterial">
  <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong></p>
  <button class="btn" onclick="setMaterial('steel')">–°—Ç–∞–ª—å</button>
  <button class="btn" onclick="setMaterial('cast_iron')">–ß—É–≥—É–Ω</button>
  <button class="btn" onclick="setMaterial('aluminum')">–ê–ª—é–º–∏–Ω–∏–π / –ú–µ–¥—å</button>
  <button class="btn" onclick="setMaterial('stainless')">–ù–µ—Ä–∂–∞–≤–µ—é—â–∞—è —Å—Ç–∞–ª—å</button>
  <button class="btn back" onclick="backToDivisionOrPitch()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="step2">
  <p><strong>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π √ò –∑–∞–≥–æ—Ç–æ–≤–∫–∏ (–º–º):</strong></p>
  <input type="number" step="0.01" id="actualDia" placeholder="–ù–∞–ø—Ä.: 19.90" />
  <button class="btn" onclick="calculateResult()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="btn back" onclick="backToMaterial()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- === –û–¢–†–ï–ó–ê–ù–ò–ï === -->
<div id="stepCuttingMaterial">
  <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong></p>
  <button class="btn" onclick="setCuttingMaterial('steel')">–°—Ç–∞–ª—å</button>
  <button class="btn" onclick="setCuttingMaterial('cast_iron')">–ß—É–≥—É–Ω</button>
  <button class="btn" onclick="setCuttingMaterial('aluminum')">–ê–ª—é–º–∏–Ω–∏–π / –ú–µ–¥—å</button>
  <button class="btn" onclick="setCuttingMaterial('stainless')">–ù–µ—Ä–∂–∞–≤–µ—é—â–∞—è —Å—Ç–∞–ª—å</button>
  <button class="btn back" onclick="backToOperation()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepCuttingTool">
  <p><strong>–¢–∏–ø –æ—Ç—Ä–µ–∑–Ω–æ–≥–æ —Ä–µ–∑—Ü–∞:</strong></p>
  <button class="btn" onclick="setCuttingTool('carbide')">–¢–≤–µ—Ä–¥–æ—Å–ø–ª–∞–≤–Ω—ã–π</button>
  <button class="btn" onclick="setCuttingTool('hss')">–ë—ã—Å—Ç—Ä–æ—Ä–µ–∂—É—â–∏–π (HSS)</button>
  <button class="btn back" onclick="backToCuttingMaterial()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepCuttingDiameter">
  <p><strong>–î–∏–∞–º–µ—Ç—Ä –∑–∞–≥–æ—Ç–æ–≤–∫–∏ (–º–º):</strong></p>
  <input type="number" step="0.1" id="cuttingDiameter" placeholder="–ù–∞–ø—Ä.: 40" />
  <button class="btn" onclick="calculateCutting()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="btn back" onclick="backToCuttingTool()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- === –¢–û–ß–ï–ù–ò–ï === -->
<div id="stepTurningType">
  <p><strong>–¢–∏–ø —Ç–æ—á–µ–Ω–∏—è:</strong></p>
  <button class="btn" onclick="setTurningType('external')">–í–Ω–µ—à–Ω–µ–µ</button>
  <button class="btn" onclick="setTurningType('internal')">–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ</button>
  <button class="btn back" onclick="backToOperation()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepTurningMaterial">
  <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong></p>
  <button class="btn" onclick="setTurningMaterial('steel')">–°—Ç–∞–ª—å</button>
  <button class="btn" onclick="setTurningMaterial('cast_iron')">–ß—É–≥—É–Ω</button>
  <button class="btn" onclick="setTurningMaterial('aluminum')">–ê–ª—é–º–∏–Ω–∏–π / –ú–µ–¥—å</button>
  <button class="btn" onclick="setTurningMaterial('stainless')">–ù–µ—Ä–∂–∞–≤–µ—é—â–∞—è —Å—Ç–∞–ª—å</button>
  <button class="btn back" onclick="backToTurningType()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepTurningDiameters">
  <p><strong>–ù–∞—á–∞–ª—å–Ω—ã–π √ò (–º–º):</strong></p>
  <input type="number" step="0.01" id="turningStartDia" placeholder="–ù–∞–ø—Ä.: 50.00" />
  <p><strong>–ö–æ–Ω–µ—á–Ω—ã–π √ò (–º–º):</strong></p>
  <input type="number" step="0.01" id="turningEndDia" placeholder="–ù–∞–ø—Ä.: 45.00" />
  <p><strong>–î–ª–∏–Ω–∞ —É—á–∞—Å—Ç–∫–∞ (–º–º):</strong></p>
  <input type="number" step="0.1" id="turningLength" placeholder="–ù–∞–ø—Ä.: 30" />
  <button class="btn" onclick="calculateTurning()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="btn back" onclick="backToTurningMaterial()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- === –°–í–ï–†–õ–ï–ù–ò–ï === -->
<div id="stepDrillingMaterial">
  <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong></p>
  <button class="btn" onclick="setDrillingMaterial('steel')">–°—Ç–∞–ª—å</button>
  <button class="btn" onclick="setDrillingMaterial('cast_iron')">–ß—É–≥—É–Ω</button>
  <button class="btn" onclick="setDrillingMaterial('aluminum')">–ê–ª—é–º–∏–Ω–∏–π / –ú–µ–¥—å</button>
  <button class="btn" onclick="setDrillingMaterial('stainless')">–ù–µ—Ä–∂–∞–≤–µ—é—â–∞—è —Å—Ç–∞–ª—å</button>
  <button class="btn back" onclick="backToOperation()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepDrillingDiameter">
  <p><strong>–î–∏–∞–º–µ—Ç—Ä —Å–≤–µ—Ä–ª–∞ (–º–º):</strong></p>
  <input type="number" step="0.1" id="drillDiameter" placeholder="–ù–∞–ø—Ä.: 10.0" />
  <button class="btn" onclick="calculateDrilling()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="btn back" onclick="backToDrillingMaterial()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- === –§–ê–°–ö–ò === -->
<div id="stepChamferType">
  <p><strong>–¢–∏–ø —Ñ–∞—Å–∫–∏:</strong></p>
  <button class="btn" onclick="setChamferType('45')">45¬∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è)</button>
  <button class="btn" onclick="setChamferType('60')">60¬∞</button>
  <button class="btn" onclick="setChamferType('30')">30¬∞</button>
  <button class="btn back" onclick="backToOperation()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<div id="stepChamferDiameter">
  <p><strong>–î–∏–∞–º–µ—Ç—Ä –∑–∞–≥–æ—Ç–æ–≤–∫–∏ (–º–º):</strong></p>
  <input type="number" step="0.01" id="chamferDiameter" placeholder="–ù–∞–ø—Ä.: 20.00" />
  <button class="btn" onclick="calculateChamfer()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="btn back" onclick="backToChamferType()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- === –†–ï–ó–£–õ–¨–¢–ê–¢–´ === -->
<div id="stepResult">
  <h2 id="resultTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
  <div id="resultContent" class="result"></div>
  <button class="btn" onclick="resetAll()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
</div>

<script>
// === –ë–ê–ó–´ ===
const THREAD_DB = {
  3: [0.5], 3.5: [0.6], 4: [0.7], 5: [0.8], 6: [1.0], 7: [1.0],
  8: [1.25, 1.0, 0.75], 9: [1.25, 1.0], 10: [1.5, 1.25, 1.0, 0.75],
  11: [1.5, 1.0], 12: [1.75, 1.5, 1.25, 1.0],
  13: [2.0, 1.5, 1.0, 0.75],
  14: [2.0, 1.5, 1.25, 1.0],
  15: [2.0, 1.5, 1.0, 0.75],
  16: [2.0, 1.5, 1.0], 17: [2.0, 1.5, 1.0],
  18: [2.5, 2.0, 1.5, 1.25, 1.0], 20: [2.5, 2.0, 1.5, 1.0],
  22: [2.5, 2.0, 1.5, 1.0], 24: [3.0, 2.0, 1.5, 1.0],
  25: [3.0, 2.0, 1.5, 1.0], 26: [3.0, 2.0, 1.5],
  27: [3.0, 2.0, 1.5, 1.0], 28: [3.0, 2.0, 1.5, 1.0],
  30: [3.5, 3.0, 2.0, 1.5, 1.0], 32: [3.5, 3.0, 2.0, 1.5],
  33: [3.5, 3.0, 2.0], 35: [3.5, 3.0, 2.0, 1.5],
  36: [4.0, 3.0, 2.0, 1.5], 38: [4.0, 3.0, 2.0],
  39: [4.0, 3.0, 2.0], 40: [4.0, 3.0, 2.0, 1.5],
  42: [4.5, 4.0, 3.0, 2.0], 45: [4.5, 4.0, 3.0, 2.0],
  48: [5.0, 4.0, 3.0, 2.0], 50: [5.0, 4.0, 3.0, 2.0],
  52: [5.0, 4.0, 3.0], 55: [5.5, 4.0, 3.0],
  56: [5.5, 4.0, 3.0], 58: [5.5, 4.0, 3.0],
  60: [6.0, 4.0, 3.0], 62: [6.0, 4.0, 3.0],
  64: [6.0, 4.0, 3.0], 65: [6.0, 4.0, 3.0],
  68: [6.0, 4.0, 3.0], 70: [6.0, 4.0, 3.0],
  72: [6.0, 4.0, 3.0], 75: [6.0, 4.0, 3.0],
  76: [6.0, 4.0, 3.0], 80: [6.0, 4.0, 3.0],
  85: [6.0, 4.0, 3.0], 90: [6.0, 4.0, 3.0],
  95: [6.0, 4.0, 3.0], 100: [6.0, 4.0, 3.0]
};

const CUTTING_DATA = {
  steel: { carbide: { vc: 150, feed: 0.10 }, hss: { vc: 30, feed: 0.05 } },
  cast_iron: { carbide: { vc: 125, feed: 0.15 }, hss: { vc: 25, feed: 0.04 } },
  aluminum: { carbide: { vc: 400, feed: 0.20 }, hss: { vc: 60, feed: 0.08 } },
  stainless: { carbide: { vc: 80, feed: 0.08 }, hss: { vc: 15, feed: 0.03 } }
};

const TURNING_DATA = {
  steel: { vc: 120, feed: 0.2 },
  cast_iron: { vc: 100, feed: 0.25 },
  aluminum: { vc: 300, feed: 0.3 },
  stainless: { vc: 60, feed: 0.1 }
};

const DRILLING_DATA = {
  steel: { vc: 25, feed: 0.1 },
  cast_iron: { vc: 30, feed: 0.12 },
  aluminum: { vc: 80, feed: 0.2 },
  stainless: { vc: 15, feed: 0.05 }
};

const VC_TABLE = {
  steel: 25,
  cast_iron: 40,
  aluminum: 80,
  stainless: 15
};

// === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
let currentOperation = "";
let threadType = "";
let selectedGroup = "";
let selectedDiameter = 0;
let selectedPitch = 0;
let selectedDivision = 0.05;
let selectedMaterial = "steel";
let cuttingMaterial = "steel";
let cuttingTool = "carbide";
let turningType = "external";
let turningMaterial = "steel";
let drillingMaterial = "steel";
let chamferType = "45";

const GROUPS = {
  small: [3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20],
  medium: [22, 24, 25, 26, 27, 28, 30, 32, 33, 35, 36, 38, 39, 40],
  large: [42, 45, 48, 50, 52, 55, 56, 58, 60],
  extra: [62, 64, 65, 68, 70, 72, 75, 76, 80, 85, 90, 95, 100]
};

// === –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
function setOperation(op) {
  currentOperation = op;
  hideAllSteps();
  if (op === 'threading') {
    document.getElementById("stepThreadType").style.display = "block";
  } else if (op === 'cutting') {
    document.getElementById("stepCuttingMaterial").style.display = "block";
  } else if (op === 'turning') {
    document.getElementById("stepTurningType").style.display = "block";
  } else if (op === 'drilling') {
    document.getElementById("stepDrillingMaterial").style.display = "block";
  } else if (op === 'chamfer') {
    document.getElementById("stepChamferType").style.display = "block";
  }
}

function hideAllSteps() {
  const steps = document.querySelectorAll('[id^="step"]');
  steps.forEach(step => step.style.display = "none");
}

// === –ù–ê–†–ï–ó–ö–ê –†–ï–ó–¨–ë–´ ===
function setThreadType(type) {
  threadType = type;
  hideAllSteps();
  document.getElementById("stepGroup").style.display = "block";
}

function selectGroup(group) {
  selectedGroup = group;
  hideAllSteps();
  const list = document.getElementById("diaList");
  list.innerHTML = "";

  const title = document.createElement("div");
  title.className = "group-title";
  title.textContent = getGroupName(group);
  list.appendChild(title);

  GROUPS[group].forEach(d => {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.textContent = "–ú" + d;
    btn.onclick = () => {
      selectedDiameter = d;
      showPitchStep();
    };
    list.appendChild(btn);
  });
  document.getElementById("step1").style.display = "block";
}

function getGroupName(group) {
  switch(group) {
    case "small": return "–ú3 ‚Äì –ú20";
    case "medium": return "–ú22 ‚Äì –ú40";
    case "large": return "–ú42 ‚Äì –ú60";
    case "extra": return "–ú62 ‚Äì –ú100";
    default: return "–ì—Ä—É–ø–ø–∞";
  }
}

function showPitchStep() {
  const steps = THREAD_DB[selectedDiameter];
  document.getElementById("pitchFor").textContent = "–ú" + selectedDiameter;
  const pitchSel = document.getElementById("pitchSelect");
  pitchSel.innerHTML = "";

  const standard = steps[0];
  steps.sort((a,b) => a - b).forEach(p => {
    const opt = document.createElement("option");
    opt.value = p;
    let text = p + " –º–º";
    if (p === standard) {
      text += " (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–≥)";
      opt.classList.add("standard-step");
    }
    opt.textContent = text;
    pitchSel.appendChild(opt);
  });

  hideAllSteps();
  document.getElementById("stepPitch").style.display = "block";
}

function selectPitch() {
  const val = document.getElementById("pitchSelect").value;
  if (!val) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–≥!");
  selectedPitch = parseFloat(val);

  if (threadType === "internal") {
    hideAllSteps();
    document.getElementById("stepMaterial").style.display = "block";
  } else {
    hideAllSteps();
    document.getElementById("stepDiv").style.display = "block";
  }
}

function setDivision(div) {
  selectedDivision = div;
  hideAllSteps();
  document.getElementById("stepMaterial").style.display = "block";
}

function setMaterial(material) {
  selectedMaterial = material;
  if (threadType === "external") {
    hideAllSteps();
    document.getElementById("step2").style.display = "block";
  } else {
    calculateInternalResult();
  }
}

function showActualDiameterStep() {
  hideAllSteps();
  document.getElementById("step2").style.display = "block";
  document.getElementById("actualDia").focus();
}

function calculateResult() {
  const actual = parseFloat(document.getElementById("actualDia").value);
  if (isNaN(actual)) return alert("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!");

  let targetBlank;
  if (selectedDiameter <= 10) targetBlank = selectedDiameter - 0.04;
  else if (selectedDiameter <= 30) targetBlank = selectedDiameter - 0.05;
  else if (selectedDiameter <= 50) targetBlank = selectedDiameter - 0.06;
  else if (selectedDiameter <= 80) targetBlank = selectedDiameter - 0.07;
  else targetBlank = selectedDiameter - 0.08;
  targetBlank = parseFloat(targetBlank.toFixed(2));

  const toTurn = Math.max(parseFloat((actual - targetBlank).toFixed(2)), 0);
  const h = 0.61343 * selectedPitch;
  const depthDiam = 2 * h;
  const divisions = Math.round(depthDiam / selectedDivision);

  const Vc = VC_TABLE[selectedMaterial];
  const rpm = Math.round((1000 * Vc) / (Math.PI * actual));
  const materialNames = { steel: "–°—Ç–∞–ª—å", cast_iron: "–ß—É–≥—É–Ω", aluminum: "–ê–ª—é–º–∏–Ω–∏–π", stainless: "–ù–µ—Ä–∂–∞–≤–µ–π–∫–∞" };

  let html = `
    <p><strong>üéØ –¶–µ–ª–µ–≤–æ–π √ò –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong> ${targetBlank} –º–º</p>
    <p><strong>üîΩ –û–±—Ç–æ—á–∏—Ç—å:</strong> ${toTurn} –º–º</p>
    <p><strong>‚öôÔ∏è –¶–µ–Ω–∞ –¥–µ–ª–µ–Ω–∏—è:</strong> ${selectedDivision} –º–º</p>
    <p class="info-note">üîÑ –û–±–æ—Ä–æ—Ç—ã: ‚âà ${rpm} –æ–±/–º–∏–Ω (${materialNames[selectedMaterial]})</p>
    <p><strong>–ì–ª—É–±–∏–Ω–∞ —Ä–µ–∑—å–±—ã:</strong></p>
    <p>–†–∞–¥–∏—É—Å: ${h.toFixed(3)} –º–º</p>
    <p>–î–∏–∞–º–µ—Ç—Ä: ${depthDiam.toFixed(3)} –º–º</p>
    <p>–õ–∏–º–±: ${divisions} –¥–µ–ª.</p>
  `;
  document.getElementById("resultTitle").textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ú${selectedDiameter}√ó${selectedPitch}`;
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

function calculateInternalResult() {
  const holeDia = (selectedDiameter - selectedPitch).toFixed(2);
  const drillDia = holeDia;

  const VcDrill = VC_TABLE[selectedMaterial] * 0.8;
  const drillRpm = Math.round((1000 * VcDrill) / (Math.PI * drillDia));
  const materialNames = { steel: "–°—Ç–∞–ª—å", cast_iron: "–ß—É–≥—É–Ω", aluminum: "–ê–ª—é–º–∏–Ω–∏–π", stainless: "–ù–µ—Ä–∂–∞–≤–µ–π–∫–∞" };

  let html = `
    <p><strong>üéØ –°–≤–µ—Ä–ª–∏—Ç—å –¥–æ √ò:</strong> ${drillDia} –º–º</p>
    <p class="info-note">üîÑ –û–±–æ—Ä–æ—Ç—ã —Å–≤–µ—Ä–ª–µ–Ω–∏—è: ‚âà ${drillRpm} –æ–±/–º–∏–Ω (${materialNames[selectedMaterial]})</p>
    <p><strong>–ì–ª—É–±–∏–Ω–∞ —Ä–µ–∑—å–±—ã:</strong></p>
    <p>–†–∞–¥–∏—É—Å: ${(0.61343 * selectedPitch).toFixed(3)} –º–º</p>
    <p>–î–∏–∞–º–µ—Ç—Ä: ${(2 * 0.61343 * selectedPitch).toFixed(3)} –º–º</p>
  `;
  document.getElementById("resultTitle").textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ú${selectedDiameter}√ó${selectedPitch} (–≤–Ω—É—Ç—Ä.)`;
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

// === –û–¢–†–ï–ó–ê–ù–ò–ï ===
function setCuttingMaterial(mat) {
  cuttingMaterial = mat;
  hideAllSteps();
  document.getElementById("stepCuttingTool").style.display = "block";
}

function setCuttingTool(tool) {
  cuttingTool = tool;
  hideAllSteps();
  document.getElementById("stepCuttingDiameter").style.display = "block";
}

function calculateCutting() {
  const dia = parseFloat(document.getElementById("cuttingDiameter").value);
  if (isNaN(dia) || dia <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä!");

  const data = CUTTING_DATA[cuttingMaterial][cuttingTool];
  const vc = data.vc;
  const feed = data.feed;
  const rpm = Math.round((1000 * vc) / (Math.PI * dia));

  const materialNames = { steel: "–°—Ç–∞–ª—å", cast_iron: "–ß—É–≥—É–Ω", aluminum: "–ê–ª—é–º–∏–Ω–∏–π", stainless: "–ù–µ—Ä–∂–∞–≤–µ–π–∫–∞" };
  const toolNames = { carbide: "–¢–≤–µ—Ä–¥–æ—Å–ø–ª–∞–≤–Ω—ã–π", hss: "–ë—ã—Å—Ç—Ä–æ—Ä–µ–∂—É—â–∏–π (HSS)" };

  let html = `
    <p><strong>üéØ –ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> ${materialNames[cuttingMaterial]}</p>
    <p><strong>üîß –†–µ–∑–µ—Ü:</strong> ${toolNames[cuttingTool]}</p>
    <p><strong>‚åÄ –ó–∞–≥–æ—Ç–æ–≤–∫–∏:</strong> ${dia.toFixed(1)} –º–º</p>
    <p><strong>‚ö° –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∑–∞–Ω–∏—è Vc:</strong> ${vc} –º/–º–∏–Ω</p>
    <p><strong>üîÑ –û–±–æ—Ä–æ—Ç—ã n:</strong> ${rpm} –æ–±/–º–∏–Ω</p>
    <p><strong>‚û°Ô∏è –ü–æ–¥–∞—á–∞ S:</strong> ${feed} –º–º/–æ–±</p>
  `;
  document.getElementById("resultTitle").textContent = "–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Ä–µ–∑–∞–Ω–∏—è";
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

// === –¢–û–ß–ï–ù–ò–ï ===
function setTurningType(type) {
  turningType = type;
  hideAllSteps();
  document.getElementById("stepTurningMaterial").style.display = "block";
}

function setTurningMaterial(mat) {
  turningMaterial = mat;
  hideAllSteps();
  document.getElementById("stepTurningDiameters").style.display = "block";
}

function calculateTurning() {
  const start = parseFloat(document.getElementById("turningStartDia").value);
  const end = parseFloat(document.getElementById("turningEndDia").value);
  const length = parseFloat(document.getElementById("turningLength").value);
  
  if (isNaN(start) || isNaN(end) || isNaN(length) || start <= end) {
    return alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–æ–¥: –Ω–∞—á–∞–ª—å–Ω—ã–π √ò > –∫–æ–Ω–µ—á–Ω–æ–≥–æ");
  }

  const depth = ((start - end) / 2).toFixed(2);
  const data = TURNING_DATA[turningMaterial];
  const vc = data.vc;
  const feed = data.feed;
  const rpm = Math.round((1000 * vc) / (Math.PI * start));

  const materialNames = { steel: "–°—Ç–∞–ª—å", cast_iron: "–ß—É–≥—É–Ω", aluminum: "–ê–ª—é–º–∏–Ω–∏–π", stainless: "–ù–µ—Ä–∂–∞–≤–µ–π–∫–∞" };

  let html = `
    <p><strong>üéØ –ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> ${materialNames[turningMaterial]}</p>
    <p><strong>‚åÄ –ù–∞—á–∞–ª—å–Ω—ã–π:</strong> ${start} –º–º</p>
    <p><strong>‚åÄ –ö–æ–Ω–µ—á–Ω—ã–π:</strong> ${end} –º–º</p>
    <p><strong>üìè –î–ª–∏–Ω–∞:</strong> ${length} –º–º</p>
    <p><strong>üîΩ –ì–ª—É–±–∏–Ω–∞ —Ä–µ–∑–∞–Ω–∏—è:</strong> ${depth} –º–º</p>
    <p><strong>‚ö° Vc:</strong> ${vc} –º/–º–∏–Ω</p>
    <p><strong>üîÑ –û–±–æ—Ä–æ—Ç—ã:</strong> ${rpm} –æ–±/–º–∏–Ω</p>
    <p><strong>‚û°Ô∏è –ü–æ–¥–∞—á–∞:</strong> ${feed} –º–º/–æ–±</p>
  `;
  document.getElementById("resultTitle").textContent = "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–æ—á–µ–Ω–∏—è";
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

// === –°–í–ï–†–õ–ï–ù–ò–ï ===
function setDrillingMaterial(mat) {
  drillingMaterial = mat;
  hideAllSteps();
  document.getElementById("stepDrillingDiameter").style.display = "block";
}

function calculateDrilling() {
  const dia = parseFloat(document.getElementById("drillDiameter").value);
  if (isNaN(dia) || dia <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä!");

  const data = DRILLING_DATA[drillingMaterial];
  const vc = data.vc;
  const feed = data.feed;
  const rpm = Math.round((1000 * vc) / (Math.PI * dia));

  const materialNames = { steel: "–°—Ç–∞–ª—å", cast_iron: "–ß—É–≥—É–Ω", aluminum: "–ê–ª—é–º–∏–Ω–∏–π", stainless: "–ù–µ—Ä–∂–∞–≤–µ–π–∫–∞" };

  let html = `
    <p><strong>üéØ –ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> ${materialNames[drillingMaterial]}</p>
    <p><strong>‚åÄ –°–≤–µ—Ä–ª–∞:</strong> ${dia} –º–º</p>
    <p><strong>‚ö° Vc:</strong> ${vc} –º/–º–∏–Ω</p>
    <p><strong>üîÑ –û–±–æ—Ä–æ—Ç—ã:</strong> ${rpm} –æ–±/–º–∏–Ω</p>
    <p><strong>‚û°Ô∏è –ü–æ–¥–∞—á–∞:</strong> ${feed} –º–º/–æ–±</p>
  `;
  document.getElementById("resultTitle").textContent = "–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–≤–µ—Ä–ª–µ–Ω–∏—è";
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

// === –§–ê–°–ö–ò ===
function setChamferType(type) {
  chamferType = type;
  hideAllSteps();
  document.getElementById("stepChamferDiameter").style.display = "block";
}

function calculateChamfer() {
  const dia = parseFloat(document.getElementById("chamferDiameter").value);
  if (isNaN(dia) || dia <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä!");

  // –§–∞—Å–∫–∞ 1√ó45¬∞ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç
  const offset = 1.0; // –º–º
  const vc = 120; // –º/–º–∏–Ω (—Å—Ç–∞–ª—å)
  const rpm = Math.round((1000 * vc) / (Math.PI * dia));

  let angle = "45¬∞";
  if (chamferType === "60") angle = "60¬∞";
  if (chamferType === "30") angle = "30¬∞";

  let html = `
    <p><strong>üéØ –î–∏–∞–º–µ—Ç—Ä –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</strong> ${dia} –º–º</p>
    <p><strong>üìê –£–≥–æ–ª —Ñ–∞—Å–∫–∏:</strong> ${angle}</p>
    <p><strong>üìè –û—Ç—Å—Ç—É–ø –ø–æ Z:</strong> ${offset} –º–º</p>
    <p><strong>üîÑ –û–±–æ—Ä–æ—Ç—ã:</strong> ${rpm} –æ–±/–º–∏–Ω</p>
    <p class="info-note">‚ÑπÔ∏è –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–∞—Å–∫–∞ 1√ó${angle}. –ü–æ–¥–∞—á–∞ ‚Äî —Ä—É—á–Ω–∞—è.</p>
  `;
  document.getElementById("resultTitle").textContent = "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞—Å–∫–∏";
  document.getElementById("resultContent").innerHTML = html;
  hideAllSteps();
  document.getElementById("stepResult").style.display = "block";
}

// === –°–ë–†–û–° ===
function resetAll() {
  hideAllSteps();
  document.getElementById("stepOperation").style.display = "block";
  document.getElementById("actualDia").value = "";
  document.getElementById("cuttingDiameter").value = "";
  document.getElementById("turningStartDia").value = "";
  document.getElementById("turningEndDia").value = "";
  document.getElementById("turningLength").value = "";
  document.getElementById("drillDiameter").value = "";
  document.getElementById("chamferDiameter").value = "";
}

// === –ù–ê–ó–ê–î ===
function backToOperation() {
  hideAllSteps();
  document.getElementById("stepOperation").style.display = "block";
}
function backToThreadType() {
  hideAllSteps();
  document.getElementById("stepThreadType").style.display = "block";
}
function backToGroup() {
  hideAllSteps();
  document.getElementById("stepGroup").style.display = "block";
}
function backToDiameter() {
  hideAllSteps();
  document.getElementById("step1").style.display = "block";
}
function backToPitch() {
  hideAllSteps();
  document.getElementById("stepPitch").style.display = "block";
}
function backToDivisionOrPitch() {
  if (threadType === "external") {
    hideAllSteps();
    document.getElementById("stepDiv").style.display = "block";
  } else {
    hideAllSteps();
    document.getElementById("stepPitch").style.display = "block";
  }
}
function backToMaterial() {
  hideAllSteps();
  document.getElementById("stepMaterial").style.display = "block";
}
function backToCuttingMaterial() {
  hideAllSteps();
  document.getElementById("stepCuttingMaterial").style.display = "block";
}
function backToCuttingTool() {
  hideAllSteps();
  document.getElementById("stepCuttingTool").style.display = "block";
}
function backToTurningType() {
  hideAllSteps();
  document.getElementById("stepTurningType").style.display = "block";
}
function backToTurningMaterial() {
  hideAllSteps();
  document.getElementById("stepTurningMaterial").style.display = "block";
}
function backToDrillingMaterial() {
  hideAllSteps();
  document.getElementById("stepDrillingMaterial").style.display = "block";
}
function backToChamferType() {
  hideAllSteps();
  document.getElementById("stepChamferType").style.display = "block";
}

window.onload = function() {
  document.getElementById("stepOperation").style.display = "block";
};
</script>

</body>
</html>